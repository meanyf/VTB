<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PG Analyzer — интерфейс</title>
    <link rel="stylesheet" href="{{ request.url_for('static', path='style.css') }}">

  </head>
  <body>
    <div class="container">
      <header>
        <h1>PG Analyzer — инструмент для анализа запросов</h1>
        <div class="small">Поддерживается: explain, анализ статистик, N+1, рекомендации по индексам и тюнингу</div>
      </header>

      <div class="grid">
        <div>
          <div class="card">
            <label for="query">SQL запрос</label>
            <textarea id="query" rows="6" placeholder="Например: SELECT * FROM actor WHERE actor_id &lt; 10;"></textarea>

            <div style="margin-top:12px">
              <label>Параметры подключения (необязательно)</label>
              
              <!-- Выбор базы данных -->
              <div>
                <input type="radio" id="db-pagila" name="db-choice" value="pagila" checked />
                <label for="db-pagila">Тестовая база данных (pagila)</label>
              </div>

              <div>
                <input type="radio" id="db-custom" name="db-choice" value="custom" />
                <label for="db-custom">Моя база данных</label>
              </div>

              <!-- Поля для ввода параметров подключения показываются только, если выбрана "Моя база данных" -->
              <div id="custom-db-params" style="display:none;">
                <input id="host" type="text" placeholder="host (например localhost)" />
                <input id="port" type="text" placeholder="port (5432)" />
                <input id="dbname" type="text" placeholder="dbname (например test_db)" />
                <input id="user" type="text" placeholder="user" />
                <input id="password" type="password" placeholder="password" />
                
                <!-- Кнопка "Сохранить" для своей базы данных -->
                <button id="btn-save-db" class="secondary" style="margin-top: 12px;">Сохранить</button>
              </div>
            </div>

            <div class="controls">
              <button id="btn-run-explain">Run EXPLAIN</button>
              <button id="btn-analyze-indexes">Analyze Indexes</button>
              <button id="btn-analyze-stats" class="secondary">Analyze Stats</button>
              <button id="btn-get-recs" class="secondary">Get PG Recommendations</button>
              <button id="btn-nplus1" class="secondary">Find N+1</button>
              <button id="btn-clear" class="secondary">Clear Result</button>
            </div>
          </div>

          <div class="card">
            <label>Результат</label>
            <pre id="result">Ничего не запущено.</pre>
          </div>
        </div>

        <aside>
          <div class="card">
            <label>Журнал операций</label>
            <div id="log" style="max-height:420px;overflow:auto"><div class="small">Здесь отображаются уведомления о действиях.</div></div>
          </div>

          <div class="card">
            <label>Подсказки</label>
            <ul>
              <li class="small">Run EXPLAIN — выполнит explain для введённого запроса.</li>
              <li class="small">Analyze Indexes — найдёт рекомендации по индексам на основе запроса.</li>
              <li class="small">Analyze Stats — выполнит анализ статистик БД (без запроса).</li>
              <li class="small">Get PG Recommendations — общие рекомендации по настройке PostgreSQL.</li>
              <li class="small">Find N+1 — попытается выявить кандидаты на N+1 проблему.</li>
            </ul>
          </div>
        </aside>
      </div>
    </div>

    <script src="{{ request.url_for('static', path='script.js') }}"></script>
  </body>
</html>
